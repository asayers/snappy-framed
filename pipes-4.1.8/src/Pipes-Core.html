<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Pipes/Core.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-| The core functionality for the 'Proxy' monad transformer
<a name="line-2"></a>
<a name="line-3"></a>    Read "Pipes.Tutorial" if you want a beginners tutorial explaining how to use
<a name="line-4"></a>    this library.  The documentation in this module targets more advanced users
<a name="line-5"></a>    who want to understand the theory behind this library.
<a name="line-6"></a>
<a name="line-7"></a>    This module is not exported by default, and I recommend you use the
<a name="line-8"></a>    unidirectional operations exported by the "Pipes" module if you can.  You
<a name="line-9"></a>    should only use this module if you require advanced features like:
<a name="line-10"></a>
<a name="line-11"></a>    * bidirectional communication, or:
<a name="line-12"></a>
<a name="line-13"></a>    * push-based 'Pipe's.
<a name="line-14"></a>-}</span>
<a name="line-15"></a>
<a name="line-16"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes, Trustworthy #-}</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Pipes</span><span class='hs-varop'>.</span><span class='hs-conid'>Core</span> <span class='hs-layout'>(</span>
<a name="line-19"></a>    <span class='hs-comment'>-- * Proxy Monad Transformer</span>
<a name="line-20"></a>    <span class='hs-comment'>-- $proxy</span>
<a name="line-21"></a>      <span class='hs-conid'>Proxy</span>
<a name="line-22"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>runEffect</span>
<a name="line-23"></a>
<a name="line-24"></a>    <span class='hs-comment'>-- * Categories</span>
<a name="line-25"></a>    <span class='hs-comment'>-- $categories</span>
<a name="line-26"></a>
<a name="line-27"></a>    <span class='hs-comment'>-- ** Respond</span>
<a name="line-28"></a>    <span class='hs-comment'>-- $respond</span>
<a name="line-29"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>respond</span>
<a name="line-30"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>/&gt;/</span><span class='hs-layout'>)</span>
<a name="line-31"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>//&gt;</span><span class='hs-layout'>)</span>
<a name="line-32"></a>
<a name="line-33"></a>    <span class='hs-comment'>-- ** Request</span>
<a name="line-34"></a>    <span class='hs-comment'>-- $request</span>
<a name="line-35"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>request</span>
<a name="line-36"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>\&gt;\</span><span class='hs-layout'>)</span>
<a name="line-37"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;\\</span><span class='hs-layout'>)</span>
<a name="line-38"></a>
<a name="line-39"></a>    <span class='hs-comment'>-- ** Push</span>
<a name="line-40"></a>    <span class='hs-comment'>-- $push</span>
<a name="line-41"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>push</span>
<a name="line-42"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;~&gt;</span><span class='hs-layout'>)</span>
<a name="line-43"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;~</span><span class='hs-layout'>)</span>
<a name="line-44"></a>
<a name="line-45"></a>    <span class='hs-comment'>-- ** Pull</span>
<a name="line-46"></a>    <span class='hs-comment'>-- $pull</span>
<a name="line-47"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>pull</span>
<a name="line-48"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;+&gt;</span><span class='hs-layout'>)</span>
<a name="line-49"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>+&gt;&gt;</span><span class='hs-layout'>)</span>
<a name="line-50"></a>
<a name="line-51"></a>    <span class='hs-comment'>-- ** Reflect</span>
<a name="line-52"></a>    <span class='hs-comment'>-- $reflect</span>
<a name="line-53"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>reflect</span>
<a name="line-54"></a>
<a name="line-55"></a>    <span class='hs-comment'>-- * Concrete Type Synonyms</span>
<a name="line-56"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>X</span>
<a name="line-57"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Effect</span>
<a name="line-58"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Producer</span>
<a name="line-59"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Pipe</span>
<a name="line-60"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Consumer</span>
<a name="line-61"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Client</span>
<a name="line-62"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Server</span>
<a name="line-63"></a>
<a name="line-64"></a>    <span class='hs-comment'>-- * Polymorphic Type Synonyms</span>
<a name="line-65"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Effect'</span>
<a name="line-66"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Producer'</span>
<a name="line-67"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Consumer'</span>
<a name="line-68"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Client'</span>
<a name="line-69"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Server'</span>
<a name="line-70"></a>
<a name="line-71"></a>    <span class='hs-comment'>-- * Flipped operators</span>
<a name="line-72"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>\&lt;\</span><span class='hs-layout'>)</span>
<a name="line-73"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>/&lt;/</span><span class='hs-layout'>)</span>
<a name="line-74"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;~&lt;</span><span class='hs-layout'>)</span>
<a name="line-75"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>~&lt;&lt;</span><span class='hs-layout'>)</span>
<a name="line-76"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;+&lt;</span><span class='hs-layout'>)</span>
<a name="line-77"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;\\</span><span class='hs-layout'>)</span>
<a name="line-78"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>//&lt;</span><span class='hs-layout'>)</span>
<a name="line-79"></a>    <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&lt;+</span><span class='hs-layout'>)</span>
<a name="line-80"></a>
<a name="line-81"></a>    <span class='hs-comment'>-- * Re-exports</span>
<a name="line-82"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>closed</span>
<a name="line-83"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-84"></a>
<a name="line-85"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Pipes</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span> <span class='hs-layout'>(</span><span class='hs-conid'>Proxy</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>X</span><span class='hs-layout'>,</span> <span class='hs-varid'>closed</span><span class='hs-layout'>)</span>
<a name="line-86"></a>
<a name="line-87"></a><span class='hs-comment'>{- $proxy
<a name="line-88"></a>    Diagrammatically, you can think of a 'Proxy' as having the following shape:
<a name="line-89"></a>
<a name="line-90"></a>@
<a name="line-91"></a> Upstream | Downstream
<a name="line-92"></a>     +---------+
<a name="line-93"></a>     |         |
<a name="line-94"></a> a' &lt;==       &lt;== b'
<a name="line-95"></a>     |         |
<a name="line-96"></a> a  ==&gt;       ==&gt; b
<a name="line-97"></a>     |    |    |
<a name="line-98"></a>     +----|----+
<a name="line-99"></a>          v
<a name="line-100"></a>          r
<a name="line-101"></a>@
<a name="line-102"></a>
<a name="line-103"></a>    You can connect proxies together in five different ways:
<a name="line-104"></a>
<a name="line-105"></a>    * ('Pipes.&gt;+&gt;'): connect pull-based streams
<a name="line-106"></a>
<a name="line-107"></a>    * ('Pipes.&gt;~&gt;'): connect push-based streams
<a name="line-108"></a>
<a name="line-109"></a>    * ('Pipes.\&gt;\'): chain folds
<a name="line-110"></a>
<a name="line-111"></a>    * ('Pipes./&gt;/'): chain unfolds
<a name="line-112"></a>
<a name="line-113"></a>    * ('Control.Monad.&gt;=&gt;'): sequence proxies
<a name="line-114"></a>
<a name="line-115"></a>-}</span>
<a name="line-116"></a>
<a name="line-117"></a><a name="runEffect"></a><span class='hs-comment'>-- | Run a self-contained 'Effect', converting it back to the base monad</span>
<a name="line-118"></a><span class='hs-definition'>runEffect</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Effect</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-119"></a><span class='hs-definition'>runEffect</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span>
<a name="line-120"></a>  <span class='hs-keyword'>where</span>
<a name="line-121"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>of</span>
<a name="line-122"></a>        <span class='hs-conid'>Request</span> <span class='hs-varid'>v</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>closed</span> <span class='hs-varid'>v</span>
<a name="line-123"></a>        <span class='hs-conid'>Respond</span> <span class='hs-varid'>v</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>closed</span> <span class='hs-varid'>v</span>
<a name="line-124"></a>        <span class='hs-conid'>M</span>       <span class='hs-varid'>m</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>go</span>
<a name="line-125"></a>        <span class='hs-conid'>Pure</span>    <span class='hs-varid'>r</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>r</span>
<a name="line-126"></a><span class='hs-comment'>{-# INLINABLE runEffect #-}</span>
<a name="line-127"></a>
<a name="line-128"></a><span class='hs-comment'>{- * Keep proxy composition lower in precedence than function composition, which
<a name="line-129"></a>     is 9 at the time of of this comment, so that users can write things like:
<a name="line-130"></a>
<a name="line-131"></a>
<a name="line-132"></a>&gt; lift . k &gt;+&gt; p
<a name="line-133"></a>&gt;
<a name="line-134"></a>&gt; hoist f . k &gt;+&gt; p
<a name="line-135"></a>
<a name="line-136"></a>   * Keep the priorities different so that users can mix composition operators
<a name="line-137"></a>     like:
<a name="line-138"></a>
<a name="line-139"></a>&gt; up \&gt;\ p /&gt;/ dn
<a name="line-140"></a>&gt;
<a name="line-141"></a>&gt; up &gt;~&gt; p &gt;+&gt; dn
<a name="line-142"></a>
<a name="line-143"></a>   * Keep 'request' and 'respond' composition lower in precedence than 'pull'
<a name="line-144"></a>     and 'push' composition, so that users can do:
<a name="line-145"></a>
<a name="line-146"></a>&gt; read \&gt;\ pull &gt;+&gt; writer
<a name="line-147"></a>
<a name="line-148"></a>   * I arbitrarily choose a lower priority for downstream operators so that lazy
<a name="line-149"></a>     pull-based computations need not evaluate upstream stages unless absolutely
<a name="line-150"></a>     necessary.
<a name="line-151"></a>-}</span>
<a name="line-152"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>3</span> <span class='hs-varop'>//&gt;</span>
<a name="line-153"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>3</span> <span class='hs-varop'>&lt;\\</span>      <span class='hs-comment'>-- GHC will raise a parse error if either of these lines ends</span>
<a name="line-154"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>4</span> <span class='hs-varop'>/&gt;/</span><span class='hs-layout'>,</span> <span class='hs-varop'>&gt;\\</span> <span class='hs-comment'>-- with '\', which is why this comment is here</span>
<a name="line-155"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>4</span> <span class='hs-varop'>\&lt;\</span><span class='hs-layout'>,</span> <span class='hs-varop'>//&lt;</span>
<a name="line-156"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>5</span> <span class='hs-varop'>\&gt;\</span>      <span class='hs-comment'>-- Same thing here</span>
<a name="line-157"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>5</span> <span class='hs-varop'>/&lt;/</span>
<a name="line-158"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>6</span> <span class='hs-varop'>&lt;&lt;+</span>
<a name="line-159"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>6</span> <span class='hs-varop'>+&gt;&gt;</span>
<a name="line-160"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>7</span> <span class='hs-varop'>&gt;+&gt;</span><span class='hs-layout'>,</span> <span class='hs-varop'>&gt;&gt;~</span>
<a name="line-161"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>7</span> <span class='hs-varop'>&lt;+&lt;</span><span class='hs-layout'>,</span> <span class='hs-varop'>~&lt;&lt;</span>
<a name="line-162"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>8</span> <span class='hs-varop'>&lt;~&lt;</span>
<a name="line-163"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>8</span> <span class='hs-varop'>&gt;~&gt;</span>
<a name="line-164"></a>
<a name="line-165"></a><span class='hs-comment'>{- $categories
<a name="line-166"></a>    A 'Control.Category.Category' is a set of components that you can connect
<a name="line-167"></a>    with a composition operator, ('Control.Category..'), that has an identity,
<a name="line-168"></a>    'Control.Category.id'.  The ('Control.Category..') and 'Control.Category.id'
<a name="line-169"></a>    must satisfy the following three 'Control.Category.Category' laws:
<a name="line-170"></a>
<a name="line-171"></a>@
<a name="line-172"></a>\-\- Left identity
<a name="line-173"></a>'Control.Category.id' 'Control.Category..' f = f
<a name="line-174"></a>
<a name="line-175"></a>\-\- Right identity
<a name="line-176"></a>f 'Control.Category..' 'Control.Category.id' = f
<a name="line-177"></a>
<a name="line-178"></a>\-\- Associativity
<a name="line-179"></a>(f 'Control.Category..' g) 'Control.Category..' h = f 'Control.Category..' (g 'Control.Category..' h)
<a name="line-180"></a>@
<a name="line-181"></a>
<a name="line-182"></a>    The 'Proxy' type sits at the intersection of five separate categories, four
<a name="line-183"></a>    of which are named after their identity:
<a name="line-184"></a>
<a name="line-185"></a>@
<a name="line-186"></a>                     Identity   | Composition |  Point-ful
<a name="line-187"></a>                  +-------------+-------------+-------------+
<a name="line-188"></a> respond category |   'respond'   |     '/&gt;/'     |     '//&gt;'     |
<a name="line-189"></a> request category |   'request'   |     '\&gt;\'     |     '&gt;\\'     |
<a name="line-190"></a>    push category |   'push'      |     '&gt;~&gt;'     |     '&gt;&gt;~'     |
<a name="line-191"></a>    pull category |   'pull'      |     '&gt;+&gt;'     |     '+&gt;&gt;'     |
<a name="line-192"></a> Kleisli category |   'return'    |     'Control.Monad.&gt;=&gt;'     |     '&gt;&gt;='     |
<a name="line-193"></a>                  +-------------+-------------+-------------+
<a name="line-194"></a>@
<a name="line-195"></a>
<a name="line-196"></a>    Each composition operator has a \"point-ful\" version, analogous to how
<a name="line-197"></a>    ('&gt;&gt;=') is the point-ful version of ('Control.Monad.&gt;=&gt;').  For example,
<a name="line-198"></a>    ('//&gt;') is the point-ful version of ('/&gt;/').  The convention is that the
<a name="line-199"></a>    odd character out faces the argument that is a function.
<a name="line-200"></a>-}</span>
<a name="line-201"></a>
<a name="line-202"></a><span class='hs-comment'>{- $respond
<a name="line-203"></a>    The 'respond' category closely corresponds to the generator design pattern.
<a name="line-204"></a>
<a name="line-205"></a>    The 'respond' category obeys the category laws, where 'respond' is the
<a name="line-206"></a>    identity and ('/&gt;/') is composition:
<a name="line-207"></a>
<a name="line-208"></a>@
<a name="line-209"></a>\-\- Left identity
<a name="line-210"></a>'respond' '/&gt;/' f = f
<a name="line-211"></a>
<a name="line-212"></a>\-\- Right identity
<a name="line-213"></a>f '/&gt;/' 'respond' = f
<a name="line-214"></a>
<a name="line-215"></a>\-\- Associativity
<a name="line-216"></a>(f '/&gt;/' g) '/&gt;/' h = f '/&gt;/' (g '/&gt;/' h)
<a name="line-217"></a>@
<a name="line-218"></a>
<a name="line-219"></a>#respond-diagram#
<a name="line-220"></a>
<a name="line-221"></a>    The following diagrams show the flow of information:
<a name="line-222"></a>
<a name="line-223"></a>@
<a name="line-224"></a>'respond' :: 'Monad' m
<a name="line-225"></a>       =&gt;  a -&gt; 'Proxy' x' x a' a m a'
<a name="line-226"></a>
<a name="line-227"></a>\          a
<a name="line-228"></a>          |
<a name="line-229"></a>     +----|----+
<a name="line-230"></a>     |    |    |
<a name="line-231"></a> x' &lt;==   \\ /==== a'
<a name="line-232"></a>     |     X   |
<a name="line-233"></a> x  ==&gt;   / \\===&gt; a
<a name="line-234"></a>     |    |    |
<a name="line-235"></a>     +----|----+
<a name="line-236"></a>          v
<a name="line-237"></a>          a'
<a name="line-238"></a>
<a name="line-239"></a>('/&gt;/') :: 'Monad' m
<a name="line-240"></a>      =&gt; (a -&gt; 'Proxy' x' x b' b m a')
<a name="line-241"></a>      -&gt; (b -&gt; 'Proxy' x' x c' c m b')
<a name="line-242"></a>      -&gt; (a -&gt; 'Proxy' x' x c' c m a')
<a name="line-243"></a>
<a name="line-244"></a>\          a                   /===&gt; b                      a
<a name="line-245"></a>          |                  /      |                      |
<a name="line-246"></a>     +----|----+            /  +----|----+            +----|----+
<a name="line-247"></a>     |    v    |           /   |    v    |            |    v    |
<a name="line-248"></a> x' &lt;==       &lt;== b' &lt;==\\ / x'&lt;==       &lt;== c'    x' &lt;==       &lt;== c'
<a name="line-249"></a>     |    f    |         X     |    g    |     =      | f '/&gt;/' g |
<a name="line-250"></a> x  ==&gt;       ==&gt; b  ===/ \\ x ==&gt;       ==&gt; c     x  ==&gt;       ==&gt; c'
<a name="line-251"></a>     |    |    |           \\   |    |    |            |    |    |
<a name="line-252"></a>     +----|----+            \\  +----|----+            +----|----+
<a name="line-253"></a>          v                  \\      v                      v
<a name="line-254"></a>          a'                  \\==== b'                     a'
<a name="line-255"></a>
<a name="line-256"></a>('//&gt;') :: 'Monad' m
<a name="line-257"></a>      =&gt; 'Proxy' x' x b' b m a'
<a name="line-258"></a>      -&gt; (b -&gt; 'Proxy' x' x c' c m b')
<a name="line-259"></a>      -&gt; 'Proxy' x' x c' c m a'
<a name="line-260"></a>
<a name="line-261"></a>\                              /===&gt; b
<a name="line-262"></a>                             /      |
<a name="line-263"></a>     +---------+            /  +----|----+            +---------+
<a name="line-264"></a>     |         |           /   |    v    |            |         |
<a name="line-265"></a> x' &lt;==       &lt;== b' &lt;==\\ / x'&lt;==       &lt;== c'    x' &lt;==       &lt;== c'
<a name="line-266"></a>     |    f    |         X     |    g    |     =      | f '//&gt;' g |
<a name="line-267"></a> x  ==&gt;       ==&gt; b  ===/ \\ x ==&gt;       ==&gt; c     x  ==&gt;       ==&gt; c'
<a name="line-268"></a>     |    |    |           \\   |    |    |            |    |    |
<a name="line-269"></a>     +----|----+            \\  +----|----+            +----|----+
<a name="line-270"></a>          v                  \\      v                      v
<a name="line-271"></a>          a'                  \\==== b'                     a'
<a name="line-272"></a>@
<a name="line-273"></a>
<a name="line-274"></a>-}</span>
<a name="line-275"></a>
<a name="line-276"></a><a name="respond"></a><span class='hs-comment'>{-| Send a value of type @a@ downstream and block waiting for a reply of type
<a name="line-277"></a>    @a'@
<a name="line-278"></a>
<a name="line-279"></a>    'respond' is the identity of the respond category.
<a name="line-280"></a>-}</span>
<a name="line-281"></a><span class='hs-definition'>respond</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a'</span>
<a name="line-282"></a><span class='hs-definition'>respond</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Respond</span> <span class='hs-varid'>a</span> <span class='hs-conid'>Pure</span>
<a name="line-283"></a><span class='hs-comment'>{-# INLINABLE respond #-}</span>
<a name="line-284"></a>
<a name="line-285"></a><a name="/%3e/"></a><span class='hs-comment'>{-| Compose two unfolds, creating a new unfold
<a name="line-286"></a>
<a name="line-287"></a>@
<a name="line-288"></a>(f '/&gt;/' g) x = f x '//&gt;' g
<a name="line-289"></a>@
<a name="line-290"></a>
<a name="line-291"></a>    ('/&gt;/') is the composition operator of the respond category.
<a name="line-292"></a>-}</span>
<a name="line-293"></a><span class='hs-layout'>(</span><span class='hs-varop'>/&gt;/</span><span class='hs-layout'>)</span>
<a name="line-294"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-295"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-296"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-297"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b'</span><span class='hs-layout'>)</span>
<a name="line-298"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-299"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-300"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-301"></a><span class='hs-layout'>(</span><span class='hs-varid'>fa</span> <span class='hs-varop'>/&gt;/</span> <span class='hs-varid'>fb</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>a</span> <span class='hs-varop'>//&gt;</span> <span class='hs-varid'>fb</span>
<a name="line-302"></a><span class='hs-comment'>{-# INLINABLE (/&gt;/) #-}</span>
<a name="line-303"></a>
<a name="line-304"></a><a name="//%3e"></a><span class='hs-comment'>{-| @(p \/\/&gt; f)@ replaces each 'respond' in @p@ with @f@.
<a name="line-305"></a>
<a name="line-306"></a>    Point-ful version of ('/&gt;/')
<a name="line-307"></a>-}</span>
<a name="line-308"></a><span class='hs-layout'>(</span><span class='hs-varop'>//&gt;</span><span class='hs-layout'>)</span>
<a name="line-309"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-310"></a>    <span class='hs-keyglyph'>=&gt;</span>       <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a'</span>
<a name="line-311"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-312"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b'</span><span class='hs-layout'>)</span>
<a name="line-313"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-314"></a>    <span class='hs-keyglyph'>-&gt;</span>       <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a'</span>
<a name="line-315"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-316"></a><a name="p0"></a><span class='hs-definition'>p0</span> <span class='hs-varop'>//&gt;</span> <span class='hs-varid'>fb</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p0</span>
<a name="line-317"></a>  <span class='hs-keyword'>where</span>
<a name="line-318"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>of</span>
<a name="line-319"></a>        <span class='hs-conid'>Request</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>fx</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Request</span> <span class='hs-varid'>x'</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>fx</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-320"></a>        <span class='hs-conid'>Respond</span> <span class='hs-varid'>b</span>  <span class='hs-varid'>fb'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fb</span> <span class='hs-varid'>b</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>b'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>fb'</span> <span class='hs-varid'>b'</span><span class='hs-layout'>)</span>
<a name="line-321"></a>        <span class='hs-conid'>M</span>          <span class='hs-varid'>m</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>M</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>go</span> <span class='hs-varid'>p'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-322"></a>        <span class='hs-conid'>Pure</span>       <span class='hs-varid'>a</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pure</span> <span class='hs-varid'>a</span>
<a name="line-323"></a><span class='hs-comment'>{-# INLINABLE (//&gt;) #-}</span>
<a name="line-324"></a>
<a name="line-325"></a><span class='hs-comment'>{-# RULES
<a name="line-326"></a>    "(Request x' fx ) //&gt; fb" forall x' fx  fb .
<a name="line-327"></a>        (Request x' fx ) //&gt; fb = Request x' (\x -&gt; fx x //&gt; fb);
<a name="line-328"></a>    "(Respond b  fb') //&gt; fb" forall b  fb' fb .
<a name="line-329"></a>        (Respond b  fb') //&gt; fb = fb b &gt;&gt;= \b' -&gt; fb' b' //&gt; fb;
<a name="line-330"></a>    "(M          m  ) //&gt; fb" forall    m   fb .
<a name="line-331"></a>        (M          m  ) //&gt; fb = M (m &gt;&gt;= \p' -&gt; return (p' //&gt; fb));
<a name="line-332"></a>    "(Pure      a   ) //&gt; fb" forall a      fb .
<a name="line-333"></a>        (Pure    a     ) //&gt; fb = Pure a;
<a name="line-334"></a>  #-}</span>
<a name="line-335"></a>
<a name="line-336"></a><span class='hs-comment'>{- $request
<a name="line-337"></a>    The 'request' category closely corresponds to the iteratee design pattern.
<a name="line-338"></a>
<a name="line-339"></a>    The 'request' category obeys the category laws, where 'request' is the
<a name="line-340"></a>    identity and ('\&gt;\') is composition:
<a name="line-341"></a>
<a name="line-342"></a>@
<a name="line-343"></a>-- Left identity
<a name="line-344"></a>'request' '\&gt;\' f = f
<a name="line-345"></a>
<a name="line-346"></a>\-\- Right identity
<a name="line-347"></a>f '\&gt;\' 'request' = f
<a name="line-348"></a>
<a name="line-349"></a>\-\- Associativity
<a name="line-350"></a>(f '\&gt;\' g) '\&gt;\' h = f '\&gt;\' (g '\&gt;\' h)
<a name="line-351"></a>@
<a name="line-352"></a>
<a name="line-353"></a>#request-diagram#
<a name="line-354"></a>
<a name="line-355"></a>    The following diagrams show the flow of information:
<a name="line-356"></a>
<a name="line-357"></a>@
<a name="line-358"></a>'request' :: 'Monad' m
<a name="line-359"></a>        =&gt;  a' -&gt; 'Proxy' a' a y' y m a
<a name="line-360"></a>
<a name="line-361"></a>\          a'
<a name="line-362"></a>          |
<a name="line-363"></a>     +----|----+
<a name="line-364"></a>     |    |    |
<a name="line-365"></a> a' &lt;=====/   &lt;== y'
<a name="line-366"></a>     |         |
<a name="line-367"></a> a  ======\\   ==&gt; y
<a name="line-368"></a>     |    |    |
<a name="line-369"></a>     +----|----+
<a name="line-370"></a>          v
<a name="line-371"></a>          a
<a name="line-372"></a>
<a name="line-373"></a>('\&gt;\') :: 'Monad' m
<a name="line-374"></a>      =&gt; (b' -&gt; 'Proxy' a' a y' y m b)
<a name="line-375"></a>      -&gt; (c' -&gt; 'Proxy' b' b y' y m c)
<a name="line-376"></a>      -&gt; (c' -&gt; 'Proxy' a' a y' y m c)
<a name="line-377"></a>
<a name="line-378"></a>\          b'&lt;=====\\                c'                     c'
<a name="line-379"></a>          |        \\               |                      |
<a name="line-380"></a>     +----|----+    \\         +----|----+            +----|----+
<a name="line-381"></a>     |    v    |     \\        |    v    |            |    v    |
<a name="line-382"></a> a' &lt;==       &lt;== y'  \\== b' &lt;==       &lt;== y'    a' &lt;==       &lt;== y'
<a name="line-383"></a>     |    f    |              |    g    |     =      | f '\&gt;\' g |
<a name="line-384"></a> a  ==&gt;       ==&gt; y   /=&gt; b  ==&gt;       ==&gt; y     a  ==&gt;       ==&gt; y
<a name="line-385"></a>     |    |    |     /        |    |    |            |    |    |
<a name="line-386"></a>     +----|----+    /         +----|----+            +----|----+
<a name="line-387"></a>          v        /               v                      v
<a name="line-388"></a>          b ======/                c                      c
<a name="line-389"></a>
<a name="line-390"></a>('&gt;\\') :: Monad m
<a name="line-391"></a>      =&gt; (b' -&gt; Proxy a' a y' y m b)
<a name="line-392"></a>      -&gt; Proxy b' b y' y m c
<a name="line-393"></a>      -&gt; Proxy a' a y' y m c
<a name="line-394"></a>
<a name="line-395"></a>\          b'&lt;=====\\
<a name="line-396"></a>          |        \\
<a name="line-397"></a>     +----|----+    \\         +---------+            +---------+
<a name="line-398"></a>     |    v    |     \\        |         |            |         |
<a name="line-399"></a> a' &lt;==       &lt;== y'  \\== b' &lt;==       &lt;== y'    a' &lt;==       &lt;== y'
<a name="line-400"></a>     |    f    |              |    g    |     =      | f '&gt;\\' g |
<a name="line-401"></a> a  ==&gt;       ==&gt; y   /=&gt; b  ==&gt;       ==&gt; y     a  ==&gt;       ==&gt; y
<a name="line-402"></a>     |    |    |     /        |    |    |            |    |    |
<a name="line-403"></a>     +----|----+    /         +----|----+            +----|----+
<a name="line-404"></a>          v        /               v                      v
<a name="line-405"></a>          b ======/                c                      c
<a name="line-406"></a>@
<a name="line-407"></a>-}</span>
<a name="line-408"></a>
<a name="line-409"></a><a name="request"></a><span class='hs-comment'>{-| Send a value of type @a'@ upstream and block waiting for a reply of type @a@
<a name="line-410"></a>
<a name="line-411"></a>    'request' is the identity of the request category.
<a name="line-412"></a>-}</span>
<a name="line-413"></a><span class='hs-definition'>request</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-414"></a><span class='hs-definition'>request</span> <span class='hs-varid'>a'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Request</span> <span class='hs-varid'>a'</span> <span class='hs-conid'>Pure</span>
<a name="line-415"></a><span class='hs-comment'>{-# INLINABLE request #-}</span>
<a name="line-416"></a>
<a name="line-417"></a><a name="%5c%3e%5c"></a><span class='hs-comment'>{-| Compose two folds, creating a new fold
<a name="line-418"></a>
<a name="line-419"></a>@
<a name="line-420"></a>(f '\&gt;\' g) x = f '&gt;\\' g x
<a name="line-421"></a>@
<a name="line-422"></a>
<a name="line-423"></a>    ('\&gt;\') is the composition operator of the request category.
<a name="line-424"></a>-}</span>
<a name="line-425"></a><span class='hs-layout'>(</span><span class='hs-varop'>\&gt;\</span><span class='hs-layout'>)</span>
<a name="line-426"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-427"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-428"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-429"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-430"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-431"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-432"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-433"></a><span class='hs-layout'>(</span><span class='hs-varid'>fb'</span> <span class='hs-varop'>\&gt;\</span> <span class='hs-varid'>fc'</span><span class='hs-layout'>)</span> <span class='hs-varid'>c'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fb'</span> <span class='hs-varop'>&gt;\\</span> <span class='hs-varid'>fc'</span> <span class='hs-varid'>c'</span>
<a name="line-434"></a><span class='hs-comment'>{-# INLINABLE (\&gt;\) #-}</span>
<a name="line-435"></a>
<a name="line-436"></a><a name="%3e%5c%5c"></a><span class='hs-comment'>{-| @(f &gt;\\\\ p)@ replaces each 'request' in @p@ with @f@.
<a name="line-437"></a>
<a name="line-438"></a>    Point-ful version of ('\&gt;\')
<a name="line-439"></a>-}</span>
<a name="line-440"></a><span class='hs-layout'>(</span><span class='hs-varop'>&gt;\\</span><span class='hs-layout'>)</span>
<a name="line-441"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-442"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-443"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-444"></a>    <span class='hs-keyglyph'>-&gt;</span>        <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span>
<a name="line-445"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-446"></a>    <span class='hs-keyglyph'>-&gt;</span>        <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span>
<a name="line-447"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-448"></a><a name="fb'"></a><span class='hs-definition'>fb'</span> <span class='hs-varop'>&gt;\\</span> <span class='hs-varid'>p0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>p0</span>
<a name="line-449"></a>  <span class='hs-keyword'>where</span>
<a name="line-450"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>of</span>
<a name="line-451"></a>        <span class='hs-conid'>Request</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>fb</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fb'</span> <span class='hs-varid'>b'</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>fb</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-452"></a>        <span class='hs-conid'>Respond</span> <span class='hs-varid'>x</span>  <span class='hs-varid'>fx'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Respond</span> <span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>fx'</span> <span class='hs-varid'>x'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-453"></a>        <span class='hs-conid'>M</span>          <span class='hs-varid'>m</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>M</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>go</span> <span class='hs-varid'>p'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-454"></a>        <span class='hs-conid'>Pure</span>       <span class='hs-varid'>a</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pure</span> <span class='hs-varid'>a</span>
<a name="line-455"></a><span class='hs-comment'>{-# INLINABLE (&gt;\\) #-}</span>
<a name="line-456"></a>
<a name="line-457"></a><span class='hs-comment'>{-# RULES
<a name="line-458"></a>    "fb' &gt;\\ (Request b' fb )" forall fb' b' fb  .
<a name="line-459"></a>        fb' &gt;\\ (Request b' fb ) = fb' b' &gt;&gt;= \b -&gt; fb' &gt;\\ fb  b;
<a name="line-460"></a>    "fb' &gt;\\ (Respond x  fx')" forall fb' x  fx' .
<a name="line-461"></a>        fb' &gt;\\ (Respond x  fx') = Respond x (\x' -&gt; fb' &gt;\\ fx' x');
<a name="line-462"></a>    "fb' &gt;\\ (M          m  )" forall fb'    m   .
<a name="line-463"></a>        fb' &gt;\\ (M          m  ) = M (m &gt;&gt;= \p' -&gt; return (fb' &gt;\\ p'));
<a name="line-464"></a>    "fb' &gt;\\ (Pure    a    )" forall fb' a      .
<a name="line-465"></a>        fb' &gt;\\ (Pure    a     ) = Pure a;
<a name="line-466"></a>  #-}</span>
<a name="line-467"></a>
<a name="line-468"></a><span class='hs-comment'>{- $push
<a name="line-469"></a>    The 'push' category closely corresponds to push-based Unix pipes.
<a name="line-470"></a>
<a name="line-471"></a>    The 'push' category obeys the category laws, where 'push' is the identity
<a name="line-472"></a>    and ('&gt;~&gt;') is composition:
<a name="line-473"></a>
<a name="line-474"></a>@
<a name="line-475"></a>\-\- Left identity
<a name="line-476"></a>'push' '&gt;~&gt;' f = f
<a name="line-477"></a>
<a name="line-478"></a>\-\- Right identity
<a name="line-479"></a>f '&gt;~&gt;' 'push' = f
<a name="line-480"></a>
<a name="line-481"></a>\-\- Associativity
<a name="line-482"></a>(f '&gt;~&gt;' g) '&gt;~&gt;' h = f '&gt;~&gt;' (g '&gt;~&gt;' h)
<a name="line-483"></a>@
<a name="line-484"></a>
<a name="line-485"></a>    The following diagram shows the flow of information:
<a name="line-486"></a>
<a name="line-487"></a>@
<a name="line-488"></a>'push'  :: 'Monad' m
<a name="line-489"></a>      =&gt;  a -&gt; 'Proxy' a' a a' a m r
<a name="line-490"></a>
<a name="line-491"></a>\          a
<a name="line-492"></a>          |
<a name="line-493"></a>     +----|----+
<a name="line-494"></a>     |    v    |
<a name="line-495"></a> a' &lt;============ a'
<a name="line-496"></a>     |         |
<a name="line-497"></a> a  ============&gt; a
<a name="line-498"></a>     |    |    |
<a name="line-499"></a>     +----|----+
<a name="line-500"></a>          v
<a name="line-501"></a>          r
<a name="line-502"></a>
<a name="line-503"></a>('&gt;~&gt;') :: 'Monad' m
<a name="line-504"></a>      =&gt; (a -&gt; 'Proxy' a' a b' b m r)
<a name="line-505"></a>      -&gt; (b -&gt; 'Proxy' b' b c' c m r)
<a name="line-506"></a>      -&gt; (a -&gt; 'Proxy' a' a c' c m r)
<a name="line-507"></a>
<a name="line-508"></a>\          a                b                      a
<a name="line-509"></a>          |                |                      |
<a name="line-510"></a>     +----|----+      +----|----+            +----|----+
<a name="line-511"></a>     |    v    |      |    v    |            |    v    |
<a name="line-512"></a> a' &lt;==       &lt;== b' &lt;==       &lt;== c'    a' &lt;==       &lt;== c'
<a name="line-513"></a>     |    f    |      |    g    |     =      | f '&gt;~&gt;' g |
<a name="line-514"></a> a  ==&gt;       ==&gt; b  ==&gt;       ==&gt; c     a  ==&gt;       ==&gt; c
<a name="line-515"></a>     |    |    |      |    |    |            |    |    |
<a name="line-516"></a>     +----|----+      +----|----+            +----|----+
<a name="line-517"></a>          v                v                      v
<a name="line-518"></a>          r                r                      r
<a name="line-519"></a>@
<a name="line-520"></a>
<a name="line-521"></a>-}</span>
<a name="line-522"></a>
<a name="line-523"></a><a name="push"></a><span class='hs-comment'>{-| Forward responses followed by requests
<a name="line-524"></a>
<a name="line-525"></a>@
<a name="line-526"></a>'push' = 'respond' 'Control.Monad.&gt;=&gt;' 'request' 'Control.Monad.&gt;=&gt;' 'push'
<a name="line-527"></a>@
<a name="line-528"></a>
<a name="line-529"></a>    'push' is the identity of the push category.
<a name="line-530"></a>-}</span>
<a name="line-531"></a><span class='hs-definition'>push</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-532"></a><span class='hs-definition'>push</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span>
<a name="line-533"></a>  <span class='hs-keyword'>where</span>
<a name="line-534"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Respond</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>a'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Request</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>go</span><span class='hs-layout'>)</span>
<a name="line-535"></a><span class='hs-comment'>{-# INLINABLE push #-}</span>
<a name="line-536"></a>
<a name="line-537"></a><a name="%3e~%3e"></a><span class='hs-comment'>{-| Compose two proxies blocked while 'request'ing data, creating a new proxy
<a name="line-538"></a>    blocked while 'request'ing data
<a name="line-539"></a>
<a name="line-540"></a>@
<a name="line-541"></a>(f '&gt;~&gt;' g) x = f x '&gt;&gt;~' g
<a name="line-542"></a>@
<a name="line-543"></a>
<a name="line-544"></a>    ('&gt;~&gt;') is the composition operator of the push category.
<a name="line-545"></a>-}</span>
<a name="line-546"></a><span class='hs-layout'>(</span><span class='hs-varop'>&gt;~&gt;</span><span class='hs-layout'>)</span>
<a name="line-547"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-548"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-sel'>_a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-549"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-550"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-551"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-552"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-sel'>_a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-553"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-554"></a><span class='hs-layout'>(</span><span class='hs-varid'>fa</span> <span class='hs-varop'>&gt;~&gt;</span> <span class='hs-varid'>fb</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;&gt;~</span> <span class='hs-varid'>fb</span>
<a name="line-555"></a><span class='hs-comment'>{-# INLINABLE (&gt;~&gt;) #-}</span>
<a name="line-556"></a>
<a name="line-557"></a><a name="%3e%3e~"></a><span class='hs-comment'>{-| @(p &gt;&gt;~ f)@ pairs each 'respond' in @p@ with an 'request' in @f@.
<a name="line-558"></a>
<a name="line-559"></a>    Point-ful version of ('&gt;~&gt;')
<a name="line-560"></a>-}</span>
<a name="line-561"></a><span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;~</span><span class='hs-layout'>)</span>
<a name="line-562"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-563"></a>    <span class='hs-keyglyph'>=&gt;</span>       <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-564"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-565"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-566"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-567"></a>    <span class='hs-keyglyph'>-&gt;</span>       <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-568"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-569"></a><a name="p"></a><span class='hs-definition'>p</span> <span class='hs-varop'>&gt;&gt;~</span> <span class='hs-varid'>fb</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>of</span>
<a name="line-570"></a>    <span class='hs-conid'>Request</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>fa</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Request</span> <span class='hs-varid'>a'</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;&gt;~</span> <span class='hs-varid'>fb</span><span class='hs-layout'>)</span>
<a name="line-571"></a>    <span class='hs-conid'>Respond</span> <span class='hs-varid'>b</span>  <span class='hs-varid'>fb'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fb'</span> <span class='hs-varop'>+&gt;&gt;</span> <span class='hs-varid'>fb</span> <span class='hs-varid'>b</span>
<a name="line-572"></a>    <span class='hs-conid'>M</span>          <span class='hs-varid'>m</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>M</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>p'</span> <span class='hs-varop'>&gt;&gt;~</span> <span class='hs-varid'>fb</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-573"></a>    <span class='hs-conid'>Pure</span>       <span class='hs-varid'>r</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pure</span> <span class='hs-varid'>r</span>
<a name="line-574"></a><span class='hs-comment'>{-# INLINABLE (&gt;&gt;~) #-}</span>
<a name="line-575"></a>
<a name="line-576"></a><span class='hs-comment'>{- $pull
<a name="line-577"></a>    The 'pull' category closely corresponds to pull-based Unix pipes.
<a name="line-578"></a>
<a name="line-579"></a>    The 'pull' category obeys the category laws, where 'pull' is the identity
<a name="line-580"></a>    and ('&gt;+&gt;') is composition:
<a name="line-581"></a>
<a name="line-582"></a>@
<a name="line-583"></a>\-\- Left identity
<a name="line-584"></a>'pull' '&gt;+&gt;' f = f
<a name="line-585"></a>
<a name="line-586"></a>\-\- Right identity
<a name="line-587"></a>f '&gt;+&gt;' 'pull' = f
<a name="line-588"></a>
<a name="line-589"></a>\-\- Associativity
<a name="line-590"></a>(f '&gt;+&gt;' g) '&gt;+&gt;' h = f '&gt;+&gt;' (g '&gt;+&gt;' h)
<a name="line-591"></a>@
<a name="line-592"></a>
<a name="line-593"></a>#pull-diagram#
<a name="line-594"></a>
<a name="line-595"></a>    The following diagrams show the flow of information:
<a name="line-596"></a>
<a name="line-597"></a>@
<a name="line-598"></a>'pull'  :: 'Monad' m
<a name="line-599"></a>      =&gt;  a' -&gt; 'Proxy' a' a a' a m r
<a name="line-600"></a>
<a name="line-601"></a>\          a'
<a name="line-602"></a>          |
<a name="line-603"></a>     +----|----+
<a name="line-604"></a>     |    v    |
<a name="line-605"></a> a' &lt;============ a'
<a name="line-606"></a>     |         |
<a name="line-607"></a> a  ============&gt; a
<a name="line-608"></a>     |    |    |
<a name="line-609"></a>     +----|----+
<a name="line-610"></a>          v
<a name="line-611"></a>          r
<a name="line-612"></a>
<a name="line-613"></a>('&gt;+&gt;') :: 'Monad' m
<a name="line-614"></a>      -&gt; (b' -&gt; 'Proxy' a' a b' b m r)
<a name="line-615"></a>      -&gt; (c' -&gt; 'Proxy' b' b c' c m r)
<a name="line-616"></a>      -&gt; (c' -&gt; 'Proxy' a' a c' c m r)
<a name="line-617"></a>
<a name="line-618"></a>\          b'               c'                     c'
<a name="line-619"></a>          |                |                      |
<a name="line-620"></a>     +----|----+      +----|----+            +----|----+
<a name="line-621"></a>     |    v    |      |    v    |            |    v    |
<a name="line-622"></a> a' &lt;==       &lt;== b' &lt;==       &lt;== c'    a' &lt;==       &lt;== c'
<a name="line-623"></a>     |    f    |      |    g    |     =      | f &gt;+&gt; g |
<a name="line-624"></a> a  ==&gt;       ==&gt; b  ==&gt;       ==&gt; c     a  ==&gt;       ==&gt; c
<a name="line-625"></a>     |    |    |      |    |    |            |    |    |
<a name="line-626"></a>     +----|----+      +----|----+            +----|----+
<a name="line-627"></a>          v                v                      v
<a name="line-628"></a>          r                r                      r
<a name="line-629"></a>@
<a name="line-630"></a>
<a name="line-631"></a>-}</span>
<a name="line-632"></a>
<a name="line-633"></a><a name="pull"></a><span class='hs-comment'>{-| Forward requests followed by responses:
<a name="line-634"></a>
<a name="line-635"></a>@
<a name="line-636"></a>'pull' = 'request' 'Control.Monad.&gt;=&gt;' 'respond' 'Control.Monad.&gt;=&gt;' 'pull'
<a name="line-637"></a>@
<a name="line-638"></a>
<a name="line-639"></a>    'pull' is the identity of the pull category.
<a name="line-640"></a>-}</span>
<a name="line-641"></a><span class='hs-definition'>pull</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-642"></a><span class='hs-definition'>pull</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span>
<a name="line-643"></a>  <span class='hs-keyword'>where</span>
<a name="line-644"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>a'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Request</span> <span class='hs-varid'>a'</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Respond</span> <span class='hs-varid'>a</span> <span class='hs-varid'>go</span><span class='hs-layout'>)</span>
<a name="line-645"></a><span class='hs-comment'>{-# INLINABLE pull #-}</span>
<a name="line-646"></a>
<a name="line-647"></a><a name="%3e+%3e"></a><span class='hs-comment'>{-| Compose two proxies blocked in the middle of 'respond'ing, creating a new
<a name="line-648"></a>    proxy blocked in the middle of 'respond'ing
<a name="line-649"></a>
<a name="line-650"></a>@
<a name="line-651"></a>(f '&gt;+&gt;' g) x = f '+&gt;&gt;' g x
<a name="line-652"></a>@
<a name="line-653"></a>
<a name="line-654"></a>    ('&gt;+&gt;') is the composition operator of the pull category.
<a name="line-655"></a>-}</span>
<a name="line-656"></a><span class='hs-layout'>(</span><span class='hs-varop'>&gt;+&gt;</span><span class='hs-layout'>)</span>
<a name="line-657"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-658"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span> <span class='hs-varid'>b'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-659"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-660"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-sel'>_c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-661"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-662"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-sel'>_c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-663"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-664"></a><span class='hs-layout'>(</span><span class='hs-varid'>fb'</span> <span class='hs-varop'>&gt;+&gt;</span> <span class='hs-varid'>fc'</span><span class='hs-layout'>)</span> <span class='hs-varid'>c'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fb'</span> <span class='hs-varop'>+&gt;&gt;</span> <span class='hs-varid'>fc'</span> <span class='hs-varid'>c'</span>
<a name="line-665"></a><span class='hs-comment'>{-# INLINABLE (&gt;+&gt;) #-}</span>
<a name="line-666"></a>
<a name="line-667"></a><a name="+%3e%3e"></a><span class='hs-comment'>{-| @(f +&gt;&gt; p)@ pairs each 'request' in @p@ with a 'respond' in @f@.
<a name="line-668"></a>
<a name="line-669"></a>    Point-ful version of ('&gt;+&gt;')
<a name="line-670"></a>-}</span>
<a name="line-671"></a><span class='hs-layout'>(</span><span class='hs-varop'>+&gt;&gt;</span><span class='hs-layout'>)</span>
<a name="line-672"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-673"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-674"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-675"></a>    <span class='hs-keyglyph'>-&gt;</span>        <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-676"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-677"></a>    <span class='hs-keyglyph'>-&gt;</span>        <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-678"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-679"></a><span class='hs-definition'>fb'</span> <span class='hs-varop'>+&gt;&gt;</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>of</span>
<a name="line-680"></a>    <span class='hs-conid'>Request</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>fb</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fb'</span> <span class='hs-varid'>b'</span> <span class='hs-varop'>&gt;&gt;~</span> <span class='hs-varid'>fb</span>
<a name="line-681"></a>    <span class='hs-conid'>Respond</span> <span class='hs-varid'>c</span>  <span class='hs-varid'>fc'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Respond</span> <span class='hs-varid'>c</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fb'</span> <span class='hs-varop'>+&gt;&gt;</span> <span class='hs-varid'>fc'</span> <span class='hs-varid'>c'</span><span class='hs-layout'>)</span>
<a name="line-682"></a>    <span class='hs-conid'>M</span>          <span class='hs-varid'>m</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>M</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fb'</span> <span class='hs-varop'>+&gt;&gt;</span> <span class='hs-varid'>p'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-683"></a>    <span class='hs-conid'>Pure</span>       <span class='hs-varid'>r</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pure</span> <span class='hs-varid'>r</span>
<a name="line-684"></a><span class='hs-comment'>{-# INLINABLE (+&gt;&gt;) #-}</span>
<a name="line-685"></a>
<a name="line-686"></a><span class='hs-comment'>{- $reflect
<a name="line-687"></a>    @(reflect .)@ transforms each streaming category into its dual:
<a name="line-688"></a>
<a name="line-689"></a>    * The request category is the dual of the respond category
<a name="line-690"></a>
<a name="line-691"></a>@
<a name="line-692"></a>'reflect' '.' 'respond' = 'request'
<a name="line-693"></a>
<a name="line-694"></a>'reflect' '.' (f '/&gt;/' g) = 'reflect' '.' f '/&lt;/' 'reflect' '.' g
<a name="line-695"></a>@
<a name="line-696"></a>
<a name="line-697"></a>@
<a name="line-698"></a>'reflect' '.' 'request' = 'respond'
<a name="line-699"></a>
<a name="line-700"></a>'reflect' '.' (f '\&gt;\' g) = 'reflect' '.' f '\&lt;\' 'reflect' '.' g
<a name="line-701"></a>@
<a name="line-702"></a>
<a name="line-703"></a>    * The pull category is the dual of the push category
<a name="line-704"></a>
<a name="line-705"></a>@
<a name="line-706"></a>'reflect' '.' 'push' = 'pull'
<a name="line-707"></a>
<a name="line-708"></a>'reflect' '.' (f '&gt;~&gt;' g) = 'reflect' '.' f '&lt;+&lt;' 'reflect' '.' g
<a name="line-709"></a>@
<a name="line-710"></a>
<a name="line-711"></a>@
<a name="line-712"></a>'reflect' '.' 'pull' = 'push'
<a name="line-713"></a>
<a name="line-714"></a>'reflect' '.' (f '&gt;+&gt;' g) = 'reflect' '.' f '&lt;~&lt;' 'reflect' '.' g
<a name="line-715"></a>@
<a name="line-716"></a>-}</span>
<a name="line-717"></a>
<a name="line-718"></a><a name="reflect"></a><span class='hs-comment'>-- | Switch the upstream and downstream ends</span>
<a name="line-719"></a><span class='hs-definition'>reflect</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-720"></a><span class='hs-definition'>reflect</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span>
<a name="line-721"></a>  <span class='hs-keyword'>where</span>
<a name="line-722"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>of</span>
<a name="line-723"></a>        <span class='hs-conid'>Request</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>fa</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Respond</span> <span class='hs-varid'>a'</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>a</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>fa</span>  <span class='hs-varid'>a</span> <span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-724"></a>        <span class='hs-conid'>Respond</span> <span class='hs-varid'>b</span>  <span class='hs-varid'>fb'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Request</span> <span class='hs-varid'>b</span>  <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>b'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>fb'</span> <span class='hs-varid'>b'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-725"></a>        <span class='hs-conid'>M</span>          <span class='hs-varid'>m</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>M</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>go</span> <span class='hs-varid'>p'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-726"></a>        <span class='hs-conid'>Pure</span>    <span class='hs-varid'>r</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pure</span> <span class='hs-varid'>r</span>
<a name="line-727"></a><span class='hs-comment'>{-# INLINABLE reflect #-}</span>
<a name="line-728"></a>
<a name="line-729"></a><a name="Effect"></a><span class='hs-comment'>{-| An effect in the base monad
<a name="line-730"></a>
<a name="line-731"></a>    'Effect's neither 'Pipes.await' nor 'Pipes.yield'
<a name="line-732"></a>-}</span>
<a name="line-733"></a><a name="Effect"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Effect</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span> <span class='hs-conid'>()</span> <span class='hs-conid'>X</span>
<a name="line-734"></a>
<a name="line-735"></a><a name="Producer"></a><span class='hs-comment'>-- | 'Producer's can only 'Pipes.yield'</span>
<a name="line-736"></a><a name="Producer"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Producer</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span> <span class='hs-conid'>()</span> <span class='hs-varid'>b</span>
<a name="line-737"></a>
<a name="line-738"></a><a name="Pipe"></a><span class='hs-comment'>-- | 'Pipe's can both 'Pipes.await' and 'Pipes.yield'</span>
<a name="line-739"></a><a name="Pipe"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Pipe</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span> <span class='hs-conid'>()</span> <span class='hs-varid'>a</span> <span class='hs-conid'>()</span> <span class='hs-varid'>b</span>
<a name="line-740"></a>
<a name="line-741"></a><a name="Consumer"></a><span class='hs-comment'>-- | 'Consumer's can only 'Pipes.await'</span>
<a name="line-742"></a><a name="Consumer"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Consumer</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span> <span class='hs-conid'>()</span> <span class='hs-varid'>a</span> <span class='hs-conid'>()</span> <span class='hs-conid'>X</span>
<a name="line-743"></a>
<a name="line-744"></a><a name="Client"></a><span class='hs-comment'>{-| @Client a' a@ sends requests of type @a'@ and receives responses of
<a name="line-745"></a>    type @a@.
<a name="line-746"></a>
<a name="line-747"></a>    'Client's only 'request' and never 'respond'.
<a name="line-748"></a>-}</span>
<a name="line-749"></a><a name="Client"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Client</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-conid'>()</span> <span class='hs-conid'>X</span>
<a name="line-750"></a>
<a name="line-751"></a><a name="Server"></a><span class='hs-comment'>{-| @Server b' b@ receives requests of type @b'@ and sends responses of type
<a name="line-752"></a>    @b@.
<a name="line-753"></a>
<a name="line-754"></a>    'Server's only 'respond' and never 'request'.
<a name="line-755"></a>-}</span>
<a name="line-756"></a><a name="Server"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Server</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Proxy</span> <span class='hs-conid'>X</span> <span class='hs-conid'>()</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span>
<a name="line-757"></a>
<a name="line-758"></a><a name="Effect'"></a><span class='hs-comment'>-- | Like 'Effect', but with a polymorphic type</span>
<a name="line-759"></a><a name="Effect'"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Effect'</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-760"></a>
<a name="line-761"></a><a name="Producer'"></a><span class='hs-comment'>-- | Like 'Producer', but with a polymorphic type</span>
<a name="line-762"></a><a name="Producer'"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Producer'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-conid'>()</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-763"></a>
<a name="line-764"></a><a name="Consumer'"></a><span class='hs-comment'>-- | Like 'Consumer', but with a polymorphic type</span>
<a name="line-765"></a><a name="Consumer'"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Consumer'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Proxy</span> <span class='hs-conid'>()</span> <span class='hs-varid'>a</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-766"></a>
<a name="line-767"></a><a name="Server'"></a><span class='hs-comment'>-- | Like 'Server', but with a polymorphic type</span>
<a name="line-768"></a><a name="Server'"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Server'</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-769"></a>
<a name="line-770"></a><a name="Client'"></a><span class='hs-comment'>-- | Like 'Client', but with a polymorphic type</span>
<a name="line-771"></a><a name="Client'"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Client'</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-772"></a>
<a name="line-773"></a><a name="%5c%3c%5c"></a><span class='hs-comment'>-- | Equivalent to ('/&gt;/') with the arguments flipped</span>
<a name="line-774"></a><span class='hs-layout'>(</span><span class='hs-varop'>\&lt;\</span><span class='hs-layout'>)</span>
<a name="line-775"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-776"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b'</span><span class='hs-layout'>)</span>
<a name="line-777"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-778"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-779"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-780"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-781"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-782"></a><a name="p1"></a><span class='hs-definition'>p1</span> <span class='hs-varop'>\&lt;\</span> <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p2</span> <span class='hs-varop'>/&gt;/</span> <span class='hs-varid'>p1</span>
<a name="line-783"></a><span class='hs-comment'>{-# INLINABLE (\&lt;\) #-}</span>
<a name="line-784"></a>
<a name="line-785"></a><a name="/%3c/"></a><span class='hs-comment'>-- | Equivalent to ('\&gt;\') with the arguments flipped</span>
<a name="line-786"></a><span class='hs-layout'>(</span><span class='hs-varop'>/&lt;/</span><span class='hs-layout'>)</span>
<a name="line-787"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-788"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-789"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-790"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-791"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-792"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-793"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-794"></a><span class='hs-definition'>p1</span> <span class='hs-varop'>/&lt;/</span> <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p2</span> <span class='hs-varop'>\&gt;\</span> <span class='hs-varid'>p1</span>
<a name="line-795"></a><span class='hs-comment'>{-# INLINABLE (/&lt;/) #-}</span>
<a name="line-796"></a>
<a name="line-797"></a><a name="%3c~%3c"></a><span class='hs-comment'>-- | Equivalent to ('&gt;~&gt;') with the arguments flipped</span>
<a name="line-798"></a><span class='hs-layout'>(</span><span class='hs-varop'>&lt;~&lt;</span><span class='hs-layout'>)</span>
<a name="line-799"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-800"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-801"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-802"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-803"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-804"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-805"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-806"></a><span class='hs-definition'>p1</span> <span class='hs-varop'>&lt;~&lt;</span> <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p2</span> <span class='hs-varop'>&gt;~&gt;</span> <span class='hs-varid'>p1</span>
<a name="line-807"></a><span class='hs-comment'>{-# INLINABLE (&lt;~&lt;) #-}</span>
<a name="line-808"></a>
<a name="line-809"></a><a name="%3c+%3c"></a><span class='hs-comment'>-- | Equivalent to ('&gt;+&gt;') with the arguments flipped</span>
<a name="line-810"></a><span class='hs-layout'>(</span><span class='hs-varop'>&lt;+&lt;</span><span class='hs-layout'>)</span>
<a name="line-811"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-812"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-813"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-814"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-815"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-816"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-817"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-818"></a><span class='hs-definition'>p1</span> <span class='hs-varop'>&lt;+&lt;</span> <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p2</span> <span class='hs-varop'>&gt;+&gt;</span> <span class='hs-varid'>p1</span>
<a name="line-819"></a><span class='hs-comment'>{-# INLINABLE (&lt;+&lt;) #-}</span>
<a name="line-820"></a>
<a name="line-821"></a><a name="%3c%5c%5c"></a><span class='hs-comment'>-- | Equivalent to ('//&gt;') with the arguments flipped</span>
<a name="line-822"></a><span class='hs-layout'>(</span><span class='hs-varop'>&lt;\\</span><span class='hs-layout'>)</span>
<a name="line-823"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-824"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b'</span><span class='hs-layout'>)</span>
<a name="line-825"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-826"></a>    <span class='hs-keyglyph'>-&gt;</span>       <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a'</span>
<a name="line-827"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-828"></a>    <span class='hs-keyglyph'>-&gt;</span>       <span class='hs-conid'>Proxy</span> <span class='hs-varid'>x'</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a'</span>
<a name="line-829"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-830"></a><a name="f"></a><span class='hs-definition'>f</span> <span class='hs-varop'>&lt;\\</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span> <span class='hs-varop'>//&gt;</span> <span class='hs-varid'>f</span>
<a name="line-831"></a><span class='hs-comment'>{-# INLINABLE (&lt;\\) #-}</span>
<a name="line-832"></a>
<a name="line-833"></a><a name="//%3c"></a><span class='hs-comment'>-- | Equivalent to ('&gt;\\') with the arguments flipped</span>
<a name="line-834"></a><span class='hs-layout'>(</span><span class='hs-varop'>//&lt;</span><span class='hs-layout'>)</span>
<a name="line-835"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-836"></a>    <span class='hs-keyglyph'>=&gt;</span>        <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span>
<a name="line-837"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-838"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-839"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-840"></a>    <span class='hs-keyglyph'>-&gt;</span>        <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>y'</span> <span class='hs-varid'>y</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span>
<a name="line-841"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-842"></a><span class='hs-definition'>p</span> <span class='hs-varop'>//&lt;</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varop'>&gt;\\</span> <span class='hs-varid'>p</span>
<a name="line-843"></a><span class='hs-comment'>{-# INLINABLE (//&lt;) #-}</span>
<a name="line-844"></a>
<a name="line-845"></a><a name="~%3c%3c"></a><span class='hs-comment'>-- | Equivalent to ('&gt;&gt;~') with the arguments flipped</span>
<a name="line-846"></a><span class='hs-layout'>(</span><span class='hs-varop'>~&lt;&lt;</span><span class='hs-layout'>)</span>
<a name="line-847"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-848"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-849"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-850"></a>    <span class='hs-keyglyph'>-&gt;</span>        <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-851"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-852"></a>    <span class='hs-keyglyph'>-&gt;</span>        <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-853"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-854"></a><a name="k"></a><span class='hs-definition'>k</span> <span class='hs-varop'>~&lt;&lt;</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&gt;&gt;~</span> <span class='hs-varid'>k</span>
<a name="line-855"></a><span class='hs-comment'>{-# INLINABLE (~&lt;&lt;) #-}</span>
<a name="line-856"></a>
<a name="line-857"></a><a name="%3c%3c+"></a><span class='hs-comment'>-- | Equivalent to ('+&gt;&gt;') with the arguments flipped</span>
<a name="line-858"></a><span class='hs-layout'>(</span><span class='hs-varop'>&lt;&lt;+</span><span class='hs-layout'>)</span>
<a name="line-859"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-860"></a>    <span class='hs-keyglyph'>=&gt;</span>         <span class='hs-conid'>Proxy</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-861"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-862"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b'</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-863"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-864"></a>    <span class='hs-keyglyph'>-&gt;</span>         <span class='hs-conid'>Proxy</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>c</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span>
<a name="line-865"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-866"></a><span class='hs-definition'>k</span> <span class='hs-varop'>&lt;&lt;+</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span> <span class='hs-varop'>+&gt;&gt;</span> <span class='hs-varid'>k</span>
<a name="line-867"></a><span class='hs-comment'>{-# INLINABLE (&lt;&lt;+) #-}</span>
<a name="line-868"></a>
<a name="line-869"></a><span class='hs-comment'>{-# RULES
<a name="line-870"></a>    "(p //&gt; f) //&gt; g" forall p f g . (p //&gt; f) //&gt; g = p //&gt; (\x -&gt; f x //&gt; g)
<a name="line-871"></a>
<a name="line-872"></a>  ; "p //&gt; respond" forall p . p //&gt; respond = p
<a name="line-873"></a>
<a name="line-874"></a>  ; "respond x //&gt; f" forall x f . respond x //&gt;  f = f x
<a name="line-875"></a>
<a name="line-876"></a>  ; "f &gt;\\ (g &gt;\\ p)" forall f g p . f &gt;\\ (g &gt;\\ p) = (\x -&gt; f &gt;\\ g x) &gt;\\ p
<a name="line-877"></a>
<a name="line-878"></a>  ; "request &gt;\\ p" forall p . request &gt;\\ p = p
<a name="line-879"></a>
<a name="line-880"></a>  ; "f &gt;\\ request x" forall f x . f &gt;\\ request x = f x
<a name="line-881"></a>
<a name="line-882"></a>  ; "(p &gt;&gt;~ f) &gt;&gt;~ g" forall p f g . (p &gt;&gt;~ f) &gt;&gt;~ g = p &gt;&gt;~ (\x -&gt; f x &gt;&gt;~ g)
<a name="line-883"></a>
<a name="line-884"></a>  ; "p &gt;&gt;~ push" forall p . p &gt;&gt;~ push = p
<a name="line-885"></a>
<a name="line-886"></a>  ; "push x &gt;&gt;~ f" forall x f . push x &gt;&gt;~ f = f x
<a name="line-887"></a>
<a name="line-888"></a>  ; "f +&gt;&gt; (g +&gt;&gt; p)" forall f g p . f +&gt;&gt; (g +&gt;&gt; p) = (\x -&gt; f +&gt;&gt; g x) +&gt;&gt; p
<a name="line-889"></a>
<a name="line-890"></a>  ; "pull +&gt;&gt; p" forall p . pull +&gt;&gt; p = p
<a name="line-891"></a>
<a name="line-892"></a>  ; "f +&gt;&gt; pull x" forall f x . f +&gt;&gt; pull x = f x
<a name="line-893"></a>
<a name="line-894"></a>  #-}</span>
</pre></body>
</html>
