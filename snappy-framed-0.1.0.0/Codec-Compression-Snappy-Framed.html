<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Codec.Compression.Snappy.Framed</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Codec-Compression-Snappy-Framed.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Codec-Compression-Snappy-Framed.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">snappy-framed-0.1.0.0: Decompression for framed Snappy streams</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Codec.Compression.Snappy.Framed</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Internals</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides facilities for decoding framed Snappy streams.</p><p>Snappy is a block compression format, meaning that the whole
 compressed stream must be kept in memory until it is fully decoded [1].
 The task of splitting data into a stream of independently-decodable
 chunks is handled by the framing format. In addition, this format often
 provides checksums of the uncompressed data.</p><p>Unfortunately, for a long time snappy had no official framing format,
 and so a number of improvised formats appeared. While there is now
 a standard format, many of the historical formats are still in common
 use. The good news is that these formats mercifully begin with distinct
 magic byte sequences, and so can be easily distinguished.</p><p>The list of formats, and the names given to them, come from the snzip
 application (https:/<em>github.com</em>kubo/snzip).</p><p>[1]: In Snappy, the offsets used by back-references may be as large as
 a 32-bit word. As a result, a byte in the uncompressed stream can't be
 discarded until 4GB of uncompressed data following it has been decoded.
 This effectively makes Snappy a block compression format.</p><p>TODO (asayers): Tests</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:decompress">decompress</a> :: <a href="../base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../pipes-4.1.8/Pipes-Core.html#t:Producer">Producer</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> m (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="../base-4.8.2.0/Data-String.html#t:String">String</a> ())</li><li class="src short"><a href="#v:decompress_">decompress_</a> :: <a href="../base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../pipes-4.1.8/Pipes-Core.html#t:Producer">Producer</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> m ()</li><li class="src short"><a href="#v:decompress__">decompress__</a> :: <a href="../base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../pipes-4.1.8/Pipes-Core.html#t:Producer">Producer</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> m (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> (<a href="../pipes-attoparsec-0.5.1.2/Pipes-Attoparsec.html#t:ParsingError">ParsingError</a>, <a href="../pipes-4.1.8/Pipes-Core.html#t:Producer">Producer</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> m ()) ())</li><li class="src short"><span class="keyword">data</span> <a href="#t:FramingFormat">FramingFormat</a><ul class="subs"><li>= <a href="#v:Framing2">Framing2</a></li><li>| <a href="#v:Framing1">Framing1</a></li><li>| <a href="#v:SNZip">SNZip</a></li><li>| <a href="#v:SnappyJava">SnappyJava</a></li><li>| <a href="#v:SnappyInJava">SnappyInJava</a></li><li>| <a href="#v:Comment43">Comment43</a></li><li>| <a href="#v:NoFraming">NoFraming</a></li></ul></li><li class="src short"><a href="#v:parseHeader">parseHeader</a> :: <a href="../attoparsec-0.13.0.1/Data-Attoparsec-ByteString.html#t:Parser">Parser</a> <a href="Codec-Compression-Snappy-Framed.html#t:FramingFormat">FramingFormat</a></li><li class="src short"><a href="#v:parseBlock">parseBlock</a> :: <a href="Codec-Compression-Snappy-Framed.html#t:FramingFormat">FramingFormat</a> -&gt; <a href="../attoparsec-0.13.0.1/Data-Attoparsec-ByteString.html#t:Parser">Parser</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a name="v:decompress" class="def">decompress</a> :: <a href="../base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../pipes-4.1.8/Pipes-Core.html#t:Producer">Producer</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> m (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="../base-4.8.2.0/Data-String.html#t:String">String</a> ()) <a href="src/Codec-Compression-Snappy-Framed.html#decompress" class="link">Source</a></p><div class="doc"><p>Decompress a framed Snappy stream, reporting errors.</p></div></div><div class="top"><p class="src"><a name="v:decompress_" class="def">decompress_</a> :: <a href="../base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../pipes-4.1.8/Pipes-Core.html#t:Producer">Producer</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> m () <a href="src/Codec-Compression-Snappy-Framed.html#decompress_" class="link">Source</a></p><div class="doc"><p>Decompress a framed Snappy stream, raising an exception on bad input.
 TODO (asayers): better names</p></div></div><div class="top"><p class="src"><a name="v:decompress__" class="def">decompress__</a> :: <a href="../base-4.8.2.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../pipes-4.1.8/Pipes-Core.html#t:Producer">Producer</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> m (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> (<a href="../pipes-attoparsec-0.5.1.2/Pipes-Attoparsec.html#t:ParsingError">ParsingError</a>, <a href="../pipes-4.1.8/Pipes-Core.html#t:Producer">Producer</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> m ()) ()) <a href="src/Codec-Compression-Snappy-Framed.html#decompress__" class="link">Source</a></p><div class="doc"><p>Decompress a framed Snappy stream, returning unconsumed input in the
 case of an error.
 TODO (asayers): we can do better in terms of streaming the input.</p></div></div><h1 id="g:1">Internals</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:FramingFormat" class="def">FramingFormat</a> <a href="src/Codec-Compression-Snappy-Framed.html#FramingFormat" class="link">Source</a></p><div class="doc"><p>Snappy unfortunately has a variety of historical framing formats, and
 while the comminity has now accepted &quot;framing2&quot; as the default, Kafka
 still uses the &quot;snappy-java&quot; framing format.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Framing2" class="def">Framing2</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:Framing1" class="def">Framing1</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:SNZip" class="def">SNZip</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:SnappyJava" class="def">SnappyJava</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:SnappyInJava" class="def">SnappyInJava</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:Comment43" class="def">Comment43</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:NoFraming" class="def">NoFraming</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a name="v:parseHeader" class="def">parseHeader</a> :: <a href="../attoparsec-0.13.0.1/Data-Attoparsec-ByteString.html#t:Parser">Parser</a> <a href="Codec-Compression-Snappy-Framed.html#t:FramingFormat">FramingFormat</a> <a href="src/Codec-Compression-Snappy-Framed.html#parseHeader" class="link">Source</a></p><div class="doc"><p>Attempt to parse the headers of each format in turn. This tells us
 which format we're using. If we don't see a header we recognise, we
 assume that we've been given an unframed snappy stream.</p></div></div><div class="top"><p class="src"><a name="v:parseBlock" class="def">parseBlock</a> :: <a href="Codec-Compression-Snappy-Framed.html#t:FramingFormat">FramingFormat</a> -&gt; <a href="../attoparsec-0.13.0.1/Data-Attoparsec-ByteString.html#t:Parser">Parser</a> <a href="../bytestring-0.10.6.0/Data-ByteString.html#t:ByteString">ByteString</a> <a href="src/Codec-Compression-Snappy-Framed.html#parseBlock" class="link">Source</a></p><div class="doc"><p>Parse a single block of the compressed bytestream, returning a segment
 of the uncompressed stream.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>